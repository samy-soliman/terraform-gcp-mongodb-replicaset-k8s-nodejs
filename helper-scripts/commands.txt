# terraform apply --var-file=dev.tfvars
# terraform destroy --var-file=dev.tfvars

# install gcp gke auth tools
sudo apt-get install kubectl
sudo apt-get install google-cloud-sdk-gke-gcloud-auth-plugin

# authenticate your cluster with gcp , replace name, cluster and project with your values
gcloud container clusters get-credentials gke-cluster --region us-central1 --project exalted-kit

# authenticate artifact registry in your host, replace region with yours
gcloud auth configure-docker us-east1-docker.pkg.dev
gcloud auth print-access-token | sudo docker login -u oauth2accesstoken --password-stdin  us-east1-docker.pkg.dev

# pull bitnami image, tag and push it to our gcp registry
# note this is the name in our nodejs app for the db uri
sudo docker pull docker.io/bitnami/mongodb:4.4.4
sudo docker tag docker.io/bitnami/mongodb:4.4.4 us-east1-docker.pkg.dev/exalted-kit/mongo-registry/bitnami:v1


# build the nodejs app docker image and push it 
sudo docker build -t us-east1-docker.pkg.dev/exalted-kit/mongo-registry/nodejs:v1 .
sudo docker push  us-east1-docker.pkg.dev/exalted-kit/mongo-registry/nodejs:v1


